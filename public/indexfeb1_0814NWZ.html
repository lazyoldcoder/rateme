<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rate Me</title>
<style>
  body {
    font-family: "Helvetica Neue", sans-serif;
    margin: 0;
    padding: 1rem;
    background: #f9f9f9;
    color: #333;
  }
  h1 { text-align: center; margin-bottom: 1rem; font-size: 1.8rem; }

  /* Business Cards */
  #businessContainer {
    overflow-x: auto;
    padding-bottom: 1rem;
    margin-bottom: 1rem;
  }
  .cards-wrapper {
    display: flex;
    gap: 1rem;
  }
  .business-card {
    min-width: 120px;
    flex: 0 0 auto;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    text-align: center;
    cursor: pointer;
    padding: 0.5rem;
    transition: transform 0.2s;
  }
  .business-card.selected {
    border: 2px solid #007bff;
    transform: scale(1.05);
  }
  .business-card img {
    width: 100%;
    border-radius: 8px;
    margin-bottom: 0.3rem;
  }
  .business-card .name {
    font-weight: bold;
    font-size: 0.9rem;
  }

  /* Rating Form */
  form {
    background: #fff;
    padding: 1rem;
    border-radius: 12px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    margin-bottom: 1.5rem;
  }
  label { display: block; margin-top: 0.5rem; font-weight: bold; }
  textarea { width: 100%; padding: 0.5rem; margin-top: 0.2rem; border-radius: 6px; border: 1px solid #ccc; }

  .stars {
    display: flex;
    gap: 0.3rem;
    margin-top: 0.3rem;
  }
  .star {
    font-size: 1.5rem;
    cursor: pointer;
    color: #ccc;
  }
  .star.selected { color: gold; }

  button {
    margin-top: 1rem;
    padding: 0.7rem 1.2rem;
    border: none;
    border-radius: 8px;
    background: #007bff;
    color: white;
    font-size: 1rem;
    width: 100%;
  }

  /* Ratings list */
  #ratingsList {
    display: flex;
    flex-direction: column;
    gap: 0.8rem;
  }
  .rating-card {
    background: #fff;
    padding: 0.8rem 1rem;
    border-radius: 10px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  }
  .rating-card .stars-display {
    color: gold;
    font-size: 1.2rem;
  }
  .rating-card .timestamp {
    font-size: 0.75rem;
    color: #666;
    margin-top: 0.2rem;
  }

.full-stars {
  display: flex;
  gap: 0.5rem;
  justify-content: space-between;
  margin-top: 0.5rem;
}

.star-btn {
  flex: 1;
  font-size: 1.8rem;
  padding: 1.5rem 0;
  border: none;
  border-radius: 12px;
  background: #eee;
  cursor: pointer;
  transition: background 0.2s, transform 0.2s;
}

.star-btn.selected {
  background: #007bff;
  color: white;
  transform: scale(1.05);
}


.emoji-rating {
  display: flex;
  justify-content: space-between;
  gap: 0.5rem;
  margin-top: 0.5rem;
}

.emoji-btn {
  flex: 1;
  font-size: 2.5rem;
  padding: 1rem 0;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  background: #f0f0f0;
  transition: transform 0.2s, box-shadow 0.2s;
}

.emoji-btn[data-value="1"] { background-color: #ff4d4f; }   /* Red */
.emoji-btn[data-value="2"] { background-color: #ff7a45; }   /* Orange */
.emoji-btn[data-value="3"] { background-color: #ffd666; }   /* Yellow */
.emoji-btn[data-value="4"] { background-color: #73d13d; }   /* Light Green */
.emoji-btn[data-value="5"] { background-color: #52c41a; }   /* Green */

.emoji-btn.selected {
  box-shadow: 0 0 0 3px #1890ff;  /* Blue highlight */
  transform: scale(1.2);
  color: white; /* optional for contrast */
}


</style>
</head>
<body>

<h1>Rate Me</h1>

<!-- Business Cards -->
<div id="businessContainer"></div>

<!-- Rating Form -->
<form id="ratingForm">
  <label>Rating</label>


  <!-- <div class="stars" id="starRating">
    <span class="star" data-value="1">&#9733;</span>
    <span class="star" data-value="2">&#9733;</span>
    <span class="star" data-value="3">&#9733;</span>
    <span class="star" data-value="4">&#9733;</span>
    <span class="star" data-value="5">&#9733;</span>
  </div> -->
<!-- 
    <div id="starRating" class="full-stars">
    <button type="button" class="star-btn" data-value="1">1</button>
    <button type="button" class="star-btn" data-value="2">2</button>
    <button type="button" class="star-btn" data-value="3">3</button>
    <button type="button" class="star-btn" data-value="4">4</button>
    <button type="button" class="star-btn" data-value="5">5</button>
    </div> -->

    <div id="starRating" class="emoji-rating">
        <button type="button" class="emoji-btn" data-value="1" aria-label="Very bad">1üò°</button>
        <button type="button" class="emoji-btn" data-value="2" aria-label="Bad">2üòû</button>
        <button type="button" class="emoji-btn" data-value="3" aria-label="Neutral">3üòê</button>
        <button type="button" class="emoji-btn" data-value="4" aria-label="Good">4üôÇ</button>
        <button type="button" class="emoji-btn" data-value="5" aria-label="Excellent">5üòÑ</button>
    </div>











    
  <label for="comment">Comment</label>
  <textarea id="comment" rows="3"></textarea>

  <button type="submit">Submit</button>
</form>

<!-- Ratings List -->
<div id="ratingsContainer">
  <h2>All Ratings</h2>
  <div id="ratingsList"></div>
</div>

<script>
/* ======= Data-driven businesses ======= */
const businesses = [
  { id: 'coffee-shop', name: 'Coffee Shop', img: 'images/coffee-shop.jpg' },
  { id: 'hair-salon', name: 'Hair Salon', img: 'images/hair-salon.jpg' },
  { id: 'plumber', name: 'Plumber', img: 'images/plumber.jpg' },
  // Add more businesses here
];

/* ======= Render business cards dynamically ======= */
const businessContainer = document.getElementById('businessContainer');
const cardsWrapper = document.createElement('div');
cardsWrapper.className = 'cards-wrapper';
businessContainer.appendChild(cardsWrapper);

let currentBusiness = localStorage.getItem('lastBusiness') || businesses[0].id;

function selectBusiness(id) {
  currentBusiness = id;
  localStorage.setItem('lastBusiness', id);

  document.querySelectorAll('.business-card').forEach(card => {
    card.classList.toggle('selected', card.dataset.id === id);
  });
}

// Create cards
businesses.forEach(b => {
  const card = document.createElement('div');
  card.className = 'business-card';
  card.dataset.id = b.id;

  const img = document.createElement('img');
  img.src = b.img;
  img.alt = b.name;

  const name = document.createElement('div');
  name.className = 'name';
  name.textContent = b.name;

  card.appendChild(img);
  card.appendChild(name);
  cardsWrapper.appendChild(card);

  // Click/tap to select
  card.addEventListener('click', () => selectBusiness(b.id));
});

// Highlight last business
selectBusiness(currentBusiness);

/* ======= Star rating logic ======= */


const emojiBtns = document.querySelectorAll('.emoji-btn');
let selectedRating = 0;

emojiBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    selectedRating = parseInt(btn.dataset.value);
    emojiBtns.forEach(b => b.classList.toggle('selected', parseInt(b.dataset.value) === selectedRating));
  });
});




// const starBtns = document.querySelectorAll('.star-btn');
// let selectedRating = 0;

// starBtns.forEach(btn => {
//   btn.addEventListener('click', () => {
//     selectedRating = parseInt(btn.dataset.value);
//     starBtns.forEach(b => b.classList.toggle('selected', parseInt(b.dataset.value) === selectedRating));
//   });
// });














// const stars = document.querySelectorAll('.star');
// let selectedRating = 0;

// stars.forEach(star => {
//   star.addEventListener('click', () => {
//     selectedRating = parseInt(star.dataset.value);
//     stars.forEach(s => s.classList.toggle('selected', parseInt(s.dataset.value) <= selectedRating));
//   });
// });

/* ======= Ratings API logic ======= */
const form = document.getElementById('ratingForm');
const ratingsList = document.getElementById('ratingsList');

async function fetchRatings() {
  try {
    const res = await fetch('/api/ratings');
    const ratings = await res.json();
    // Filter ratings for current business
    const filtered = ratings.filter(r => r.business === currentBusiness);
    ratingsList.innerHTML = filtered.length
      ? filtered.map(r => `
        <div class="rating-card">
          <div class="stars-display">${'‚òÖ'.repeat(r.rating)}${'‚òÜ'.repeat(5-r.rating)}</div>
          <div>${r.comment || '<em>No comment</em>'}</div>
          <div class="timestamp">${new Date(r.timestamp).toLocaleString()}</div>
        </div>
      `).join('')
      : '<p>No ratings yet for this business.</p>';
  } catch (err) {
    ratingsList.innerHTML = '<p>Error loading ratings.</p>';
    console.error(err);
  }
}

// Submit new rating
form.addEventListener('submit', async e => {
  e.preventDefault();
  const comment = document.getElementById('comment').value.trim();
  if (!selectedRating || !currentBusiness) return;

  try {
    await fetch('/api/ratings', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ business: currentBusiness, rating: selectedRating, comment })
    });
    form.reset();
    selectedRating = 0;
    stars.forEach(s => s.classList.remove('selected'));
    fetchRatings();
  } catch (err) {
    console.error('Error submitting rating:', err);
  }
});

// Reload ratings when business changes
cardsWrapper.addEventListener('click', fetchRatings);

// Initial load
fetchRatings();
</script>

</body>
</html>
